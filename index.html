<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcella Volley Scoreboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        .animate-fall {
            animation: fall linear forwards;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .overflow-y-auto::-webkit-scrollbar {
            display: none;
        }
        /* Prevent text selection on double-click and drag */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons (simplified versions)
        const Menu = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        );

        const RotateCw = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 4 23 10 17 10"></polyline>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
        );

        const Flag = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                <line x1="4" y1="22" x2="4" y2="15"></line>
            </svg>
        );

        const Edit = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
        );

        function VolleyScoreboard() {
            const [leftTeam, setLeftTeam] = useState({
                name: 'Arcella Volley',
                score: 0,
                sets: 0,
                timeouts: 0,
                logo: 'https://www.arcellavolley.it/file/2014/05/Loghi-in-alto_051.png'
            });

            const [rightTeam, setRightTeam] = useState({
                name: 'Squadra Ospite',
                score: 0,
                sets: 0,
                timeouts: 0,
                logo: ''
            });

            const [setHistory, setSetHistory] = useState([]);
            const [menuOpen, setMenuOpen] = useState(false);
            const [manualEditMode, setManualEditMode] = useState(false);
            const [showConfetti, setShowConfetti] = useState(false);
            const [winnerMessage, setWinnerMessage] = useState('');

            const maxTimeouts = 2;

            // Load from localStorage on mount
            useEffect(() => {
                const saved = localStorage.getItem('volleyScoreboard');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        setLeftTeam({
                            name: data.leftTeam.name || 'Arcella Volley',
                            score: data.leftTeam.score || 0,
                            sets: data.leftTeam.sets || 0,
                            timeouts: data.leftTeam.timeouts || 0,
                            logo: data.leftTeam.logo !== undefined ? data.leftTeam.logo : (data.leftTeam.name === 'Arcella Volley' ? 'https://www.arcellavolley.it/file/2014/05/Loghi-in-alto_051.png' : '')
                        });
                        setRightTeam({
                            name: data.rightTeam.name || 'Squadra Ospite',
                            score: data.rightTeam.score || 0,
                            sets: data.rightTeam.sets || 0,
                            timeouts: data.rightTeam.timeouts || 0,
                            logo: data.rightTeam.logo !== undefined ? data.rightTeam.logo : (data.rightTeam.name === 'Arcella Volley' ? 'https://www.arcellavolley.it/file/2014/05/Loghi-in-alto_051.png' : '')
                        });
                        setSetHistory(data.setHistory || []);
                    } catch (e) {
                        console.error('Error loading saved data:', e);
                    }
                }
            }, []);

            // Save to localStorage whenever state changes
            useEffect(() => {
                const data = {
                    leftTeam,
                    rightTeam,
                    setHistory
                };
                localStorage.setItem('volleyScoreboard', JSON.stringify(data));
            }, [leftTeam, rightTeam, setHistory]);

            const updateScore = (team, delta) => {
                if (team === 'left') {
                    const newScore = Math.max(0, leftTeam.score + delta);
                    setLeftTeam({ ...leftTeam, score: newScore });
                } else {
                    const newScore = Math.max(0, rightTeam.score + delta);
                    setRightTeam({ ...rightTeam, score: newScore });
                }
            };

            const updateSets = (team, delta) => {
                if (team === 'left') {
                    const newSets = Math.max(0, leftTeam.sets + delta);
                    setLeftTeam({ ...leftTeam, sets: newSets });
                } else {
                    const newSets = Math.max(0, rightTeam.sets + delta);
                    setRightTeam({ ...rightTeam, sets: newSets });
                }
            };

            const updateTimeouts = (team, delta) => {
                if (team === 'left') {
                    const newTimeouts = Math.max(0, Math.min(maxTimeouts, leftTeam.timeouts + delta));
                    setLeftTeam({ ...leftTeam, timeouts: newTimeouts });
                } else {
                    const newTimeouts = Math.max(0, Math.min(maxTimeouts, rightTeam.timeouts + delta));
                    setRightTeam({ ...rightTeam, timeouts: newTimeouts });
                }
            };

            const changeName = (team) => {
                const newName = prompt(`Inserisci il nome della squadra:`, team === 'left' ? leftTeam.name : rightTeam.name);
                if (newName && newName.trim()) {
                    if (team === 'left') {
                        setLeftTeam({ ...leftTeam, name: newName.trim() });
                    } else {
                        setRightTeam({ ...rightTeam, name: newName.trim() });
                    }
                }
            };

            const changeLogo = (team) => {
                const currentLogo = team === 'left' ? leftTeam.logo : rightTeam.logo;
                const newLogo = prompt(`Inserisci l'URL del logo:`, currentLogo);
                if (newLogo !== null) {
                    if (team === 'left') {
                        setLeftTeam({ ...leftTeam, logo: newLogo.trim() });
                    } else {
                        setRightTeam({ ...rightTeam, logo: newLogo.trim() });
                    }
                }
            };

            const switchSides = () => {
                const tempTeam = { ...leftTeam };
                setLeftTeam({ ...rightTeam });
                setRightTeam({ ...tempTeam });
                setMenuOpen(false);
            };

            const endSet = () => {
                const winner = leftTeam.score > rightTeam.score ? 'left' : 'right';
                const winnerName = winner === 'left' ? leftTeam.name : rightTeam.name;

                if (leftTeam.score === rightTeam.score) {
                    alert('Il punteggio è pari! Non è possibile terminare il set.');
                    return;
                }

                setWinnerMessage(`${winnerName} ha vinto il set!`);
                setShowConfetti(true);

                // Save set history with team names to track which team won
                setSetHistory([...setHistory, {
                    leftScore: leftTeam.score,
                    rightScore: rightTeam.score,
                    leftTeamName: leftTeam.name,
                    rightTeamName: rightTeam.name,
                    winnerName: winnerName
                }]);

                setTimeout(() => {
                    // Increment set count for winner, reset scores and timeouts for both teams
                    if (winner === 'left') {
                        const updatedLeftTeam = { ...leftTeam, sets: leftTeam.sets + 1, score: 0, timeouts: 0 };
                        const updatedRightTeam = { ...rightTeam, score: 0, timeouts: 0 };
                        // Switch sides
                        setLeftTeam(updatedRightTeam);
                        setRightTeam(updatedLeftTeam);
                    } else {
                        const updatedLeftTeam = { ...leftTeam, score: 0, timeouts: 0 };
                        const updatedRightTeam = { ...rightTeam, sets: rightTeam.sets + 1, score: 0, timeouts: 0 };
                        // Switch sides
                        setLeftTeam(updatedRightTeam);
                        setRightTeam(updatedLeftTeam);
                    }

                    setTimeout(() => {
                        setShowConfetti(false);
                        setWinnerMessage('');
                    }, 500);
                }, 3000);

                setMenuOpen(false);
            };

            const resetSet = () => {
                if (confirm('Sei sicuro di voler resettare il set corrente?')) {
                    setLeftTeam({ ...leftTeam, score: 0, timeouts: 0 });
                    setRightTeam({ ...rightTeam, score: 0, timeouts: 0 });
                    setMenuOpen(false);
                }
            };

            const resetMatch = () => {
                if (confirm('Sei sicuro di voler resettare la partita?')) {
                    setLeftTeam({
                        name: 'Arcella Volley',
                        score: 0,
                        sets: 0,
                        timeouts: 0,
                        logo: 'https://www.arcellavolley.it/file/2014/05/Loghi-in-alto_051.png'
                    });
                    setRightTeam({
                        name: 'Squadra Ospite',
                        score: 0,
                        sets: 0,
                        timeouts: 0,
                        logo: ''
                    });
                    setSetHistory([]);
                    setMenuOpen(false);
                }
            };

            const toggleManualEdit = () => {
                setManualEditMode(!manualEditMode);
                setMenuOpen(false);
            };

            const getCurrentDate = () => {
                const today = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                return today.toLocaleDateString('it-IT', options);
            };

            const getCurrentSet = () => {
                return leftTeam.sets + rightTeam.sets + 1;
            };

            const matchStarted = leftTeam.score > 0 || rightTeam.score > 0 || leftTeam.sets > 0 || rightTeam.sets > 0;

            // Determine which team is Arcella and set colors accordingly
            const isLeftArcella = leftTeam.name === 'Arcella Volley';
            const leftBgColor = isLeftArcella ? 'bg-black' : 'bg-white';
            const leftTextColor = isLeftArcella ? 'text-white' : 'text-black';
            const rightBgColor = isLeftArcella ? 'bg-white' : 'bg-black';
            const rightTextColor = isLeftArcella ? 'text-black' : 'text-white';

            return (
                <div className="h-screen bg-black text-white flex flex-col relative overflow-hidden">
                    {/* Confetti Overlay */}
                    {showConfetti && (
                        <div className="fixed inset-0 z-50 pointer-events-none overflow-hidden">
                            <div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                                <div className="text-6xl font-bold text-yellow-400 animate-pulse">
                                    {winnerMessage}
                                </div>
                            </div>
                            {[...Array(50)].map((_, i) => (
                                <div
                                    key={i}
                                    className="absolute animate-fall"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: `-20px`,
                                        animationDelay: `${Math.random() * 0.5}s`,
                                        animationDuration: `${2 + Math.random() * 2}s`
                                    }}
                                >
                                    <div
                                        className={`w-3 h-3 ${
                                            Math.random() > 0.5 ? 'bg-yellow-400' : 'bg-white'
                                        } rounded-full`}
                                    />
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Top Stripe - Venue and Date */}
                    <div className="bg-yellow-400 text-black py-3 px-6">
                        <div className="flex justify-between items-center">
                            <div className="font-bold" style={{ fontSize: 'clamp(1rem, 1.5vw, 1.5rem)' }}>
                                Palestra "R. Barion"
                            </div>
                            <div className="font-semibold" style={{ fontSize: 'clamp(0.875rem, 1.2vw, 1.25rem)' }}>
                                {getCurrentDate()}
                            </div>
                        </div>
                    </div>

                    {/* Main Scoreboard */}
                    <div className="flex-1 flex min-h-0">
                        {/* Left Team */}
                        <div className={`flex-1 ${leftBgColor} ${leftTextColor} flex flex-col`}>
                            {/* Header with Logo and Team Name */}
                            <div className="p-6 flex flex-col items-start gap-4">
                                <div className="flex items-center gap-4 w-full">
                                    {/* Logo on Left */}
                                    <div
                                        className={matchStarted ? '' : 'cursor-pointer'}
                                        onClick={matchStarted ? undefined : () => changeLogo('left')}
                                    >
                                        {leftTeam.logo ? (
                                            <img
                                                src={leftTeam.logo}
                                                alt={`${leftTeam.name} Logo`}
                                                style={{ height: 'clamp(6rem, 15vh, 18rem)', width: 'clamp(6rem, 15vh, 18rem)' }}
                                                className={`object-contain ${matchStarted ? '' : 'hover:opacity-70 transition'}`}
                                            />
                                        ) : (
                                            !matchStarted && (
                                                <div
                                                    style={{ height: 'clamp(6rem, 15vh, 18rem)', width: 'clamp(6rem, 15vh, 18rem)' }}
                                                    className="border-2 border-dashed border-gray-400 rounded flex items-center justify-center hover:border-gray-600 transition"
                                                >
                                                    <span style={{ fontSize: 'clamp(0.65rem, 0.8vw, 0.85rem)' }} className="text-gray-500">
                                                        + Logo
                                                    </span>
                                                </div>
                                            )
                                        )}
                                    </div>

                                    {/* Team Name */}
                                    <div className="flex-1 text-left">
                                        <div
                                            className="cursor-pointer hover:opacity-70 transition p-2 rounded"
                                            onClick={() => changeName('left')}
                                        >
                                            <h2 className="font-bold uppercase" style={{ fontSize: 'clamp(1.75rem, 3vw, 3.5rem)' }}>
                                                {leftTeam.name}
                                            </h2>
                                        </div>
                                    </div>
                                </div>

                                {/* Timeouts below logo */}
                                <div className="flex items-center gap-2">
                                    {manualEditMode && (
                                        <button
                                            onClick={() => updateTimeouts('left', -1)}
                                            className={`${isLeftArcella ? 'bg-white text-black hover:bg-gray-200' : 'bg-black text-white hover:bg-gray-800'} w-8 h-8 rounded-full text-lg font-bold transition`}
                                        >
                                            -
                                        </button>
                                    )}
                                    <div
                                        className="cursor-pointer hover:opacity-70 transition text-center"
                                        onClick={() => updateTimeouts('left', 1)}
                                    >
                                        <div className="font-bold text-xl mb-1">TIMEOUT</div>
                                        <div className="font-bold text-3xl">{leftTeam.timeouts}</div>
                                    </div>
                                </div>
                            </div>

                            {/* Score */}
                            <div className="flex-1 flex items-center min-h-0 px-4">
                                <button
                                    onClick={() => updateScore('left', -1)}
                                    className={`${isLeftArcella ? 'bg-white text-black hover:bg-gray-200' : 'bg-black text-white hover:bg-gray-800'} w-20 h-20 rounded-full text-4xl font-bold transition flex-shrink-0`}
                                >
                                    -
                                </button>
                                <div
                                    style={{ fontSize: 'min(30vw, 60vh)' }}
                                    className="font-bold cursor-pointer hover:opacity-70 transition leading-none flex-1 text-center"
                                    onClick={() => updateScore('left', 1)}
                                >
                                    {leftTeam.score}
                                </div>
                            </div>
                        </div>

                        {/* Center Divider with Menu and Current Set */}
                        <div className="w-40 bg-yellow-400 flex flex-col relative">
                            {/* Current Set Indicator - At Top */}
                            <div className="py-6 text-center border-b-2 border-black">
                                <div className="text-black font-bold mb-1" style={{ fontSize: 'clamp(1rem, 1.5vw, 1.5rem)' }}>
                                    SET
                                </div>
                                <div className="text-black font-bold" style={{ fontSize: 'clamp(3rem, 5vw, 6rem)' }}>
                                    {getCurrentSet()}
                                </div>
                            </div>

                            {/* Sets Won Display */}
                            <div className="py-4 text-center border-b-2 border-black">
                                <div className="text-black font-bold mb-2" style={{ fontSize: 'clamp(1rem, 1.5vw, 1.5rem)' }}>
                                    SETS
                                </div>
                                <div className="flex justify-center items-center gap-4">
                                    <div className="text-black font-bold text-5xl">{leftTeam.sets}</div>
                                    <div className="text-black font-bold text-2xl">-</div>
                                    <div className="text-black font-bold text-5xl">{rightTeam.sets}</div>
                                </div>
                            </div>

                            {/* Set History Bubbles - Vertically Stacked */}
                            <div className="flex-1 flex flex-col items-center justify-start py-4 overflow-y-auto">
                                {setHistory.length > 0 && (
                                    <div className="flex flex-col gap-3 w-full px-3">
                                        {setHistory.map((set, index) => {
                                            // Determine if Arcella won this set
                                            const arcellaWon = set.winnerName === 'Arcella Volley';
                                            const winnerColor = arcellaWon ? 'bg-black text-white' : 'bg-white text-black';

                                            // Determine scores based on CURRENT team positions
                                            // We need to find which historical score belongs to the current left/right team
                                            let currentLeftScore, currentRightScore;

                                            // Check if the current left team was on the left when this set was played
                                            if (leftTeam.name === set.leftTeamName) {
                                                // No swap needed - current left was historical left
                                                currentLeftScore = set.leftScore;
                                                currentRightScore = set.rightScore;
                                            } else {
                                                // Swap needed - current left was historical right
                                                currentLeftScore = set.rightScore;
                                                currentRightScore = set.leftScore;
                                            }

                                            return (
                                                <div
                                                    key={index}
                                                    className={`${winnerColor} rounded-lg px-3 py-2 text-center`}
                                                >
                                                    <div className="text-sm opacity-70 mb-1">
                                                        Set {index + 1}
                                                    </div>
                                                    <div className="font-bold text-lg">
                                                        {currentLeftScore}-{currentRightScore}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>

                            {/* Menu Button */}
                            <div className="relative">
                                <button
                                    onClick={() => setMenuOpen(!menuOpen)}
                                    className="w-full py-4 bg-black text-yellow-400 hover:bg-gray-900 transition flex items-center justify-center"
                                >
                                    <Menu size={24} />
                                </button>

                                {menuOpen && (
                                    <div className="absolute bottom-full left-0 right-0 bg-black border-2 border-yellow-400 shadow-lg">
                                        <button
                                            onClick={endSet}
                                            className="w-full py-3 px-4 text-yellow-400 hover:bg-gray-900 transition flex items-center justify-center gap-2 border-b border-yellow-400"
                                        >
                                            <Flag size={18} />
                                            <span className="text-sm">Fine Set</span>
                                        </button>
                                        <button
                                            onClick={switchSides}
                                            className="w-full py-3 px-4 text-yellow-400 hover:bg-gray-900 transition flex items-center justify-center gap-2 border-b border-yellow-400"
                                        >
                                            <RotateCw size={18} />
                                            <span className="text-sm">Cambia Lato</span>
                                        </button>
                                        <button
                                            onClick={toggleManualEdit}
                                            className="w-full py-3 px-4 text-yellow-400 hover:bg-gray-900 transition flex items-center justify-center gap-2 border-b border-yellow-400"
                                        >
                                            <Edit size={18} />
                                            <span className="text-sm">{manualEditMode ? 'Esci Modifica' : 'Modifica Manuale'}</span>
                                        </button>
                                        <button
                                            onClick={resetSet}
                                            className="w-full py-3 px-4 text-yellow-400 hover:bg-gray-900 transition flex items-center justify-center gap-2 border-b border-yellow-400"
                                        >
                                            <RotateCw size={18} />
                                            <span className="text-sm">Reset Set</span>
                                        </button>
                                        <button
                                            onClick={resetMatch}
                                            className="w-full py-3 px-4 text-yellow-400 hover:bg-gray-900 transition flex items-center justify-center gap-2"
                                        >
                                            <RotateCw size={18} />
                                            <span className="text-sm">Reset Partita</span>
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Right Team */}
                        <div className={`flex-1 ${rightBgColor} ${rightTextColor} flex flex-col`}>
                            {/* Header with Team Name and Logo */}
                            <div className="p-6 flex flex-col items-end gap-4">
                                <div className="flex items-center gap-4 w-full">
                                    {/* Team Name */}
                                    <div className="flex-1 text-right">
                                        <div
                                            className="cursor-pointer hover:opacity-70 transition p-2 rounded"
                                            onClick={() => changeName('right')}
                                        >
                                            <h2 className="font-bold uppercase" style={{ fontSize: 'clamp(1.75rem, 3vw, 3.5rem)' }}>
                                                {rightTeam.name}
                                            </h2>
                                        </div>
                                    </div>

                                    {/* Logo on Right */}
                                    <div
                                        className={matchStarted ? '' : 'cursor-pointer'}
                                        onClick={matchStarted ? undefined : () => changeLogo('right')}
                                    >
                                        {rightTeam.logo ? (
                                            <img
                                                src={rightTeam.logo}
                                                alt={`${rightTeam.name} Logo`}
                                                style={{ height: 'clamp(6rem, 15vh, 18rem)', width: 'clamp(6rem, 15vh, 18rem)' }}
                                                className={`object-contain ${matchStarted ? '' : 'hover:opacity-70 transition'}`}
                                            />
                                        ) : (
                                            !matchStarted && (
                                                <div
                                                    style={{ height: 'clamp(6rem, 15vh, 18rem)', width: 'clamp(6rem, 15vh, 18rem)' }}
                                                    className="border-2 border-dashed border-gray-600 rounded flex items-center justify-center hover:border-gray-400 transition"
                                                >
                                                    <span style={{ fontSize: 'clamp(0.65rem, 0.8vw, 0.85rem)' }} className="text-gray-400">
                                                        + Logo
                                                    </span>
                                                </div>
                                            )
                                        )}
                                    </div>
                                </div>

                                {/* Timeouts below logo */}
                                <div className="flex items-center gap-2">
                                    <div
                                        className="cursor-pointer hover:opacity-70 transition text-center"
                                        onClick={() => updateTimeouts('right', 1)}
                                    >
                                        <div className="font-bold text-xl mb-1">TIMEOUT</div>
                                        <div className="font-bold text-3xl">{rightTeam.timeouts}</div>
                                    </div>
                                    {manualEditMode && (
                                        <button
                                            onClick={() => updateTimeouts('right', -1)}
                                            className={`${isLeftArcella ? 'bg-black text-white hover:bg-gray-800' : 'bg-white text-black hover:bg-gray-200'} w-8 h-8 rounded-full text-lg font-bold transition`}
                                        >
                                            -
                                        </button>
                                    )}
                                </div>
                            </div>

                            {/* Score */}
                            <div className="flex-1 flex items-center min-h-0 px-4">
                                <div
                                    style={{ fontSize: 'min(30vw, 60vh)' }}
                                    className="font-bold cursor-pointer hover:opacity-70 transition leading-none flex-1 text-center"
                                    onClick={() => updateScore('right', 1)}
                                >
                                    {rightTeam.score}
                                </div>
                                <button
                                    onClick={() => updateScore('right', -1)}
                                    className={`${isLeftArcella ? 'bg-black text-white hover:bg-gray-800' : 'bg-white text-black hover:bg-gray-200'} w-20 h-20 rounded-full text-4xl font-bold transition flex-shrink-0`}
                                >
                                    -
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<VolleyScoreboard />, document.getElementById('root'));
    </script>
</body>
</html>
